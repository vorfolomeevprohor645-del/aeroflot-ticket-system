<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyFlight - Система управления авиабилетами</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .login-container {
            max-width: 500px;
            margin: 100px auto;
            background-color: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .login-logo {
            font-size: 3rem;
            color: #1a2980;
            margin-bottom: 20px;
        }

        .login-title {
            color: #1a2980;
            margin-bottom: 30px;
            font-size: 1.8rem;
        }

        .login-form {
            text-align: left;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #1a2980;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .btn-login {
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .login-hint {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #666;
            background-color: #f5f9ff;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #1a2980;
        }

        .system-container {
            display: none;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .logo-text p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            text-align: right;
        }

        .user-info span {
            font-weight: 600;
        }

        .logout-btn {
            background: none;
            border: 1px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background-color: white;
            color: #1a2980;
        }

        main {
            display: flex;
            min-height: 700px;
        }

        .sidebar {
            width: 250px;
            background-color: #f5f9ff;
            padding: 25px 20px;
            border-right: 1px solid #e1e8ff;
        }

        .nav-menu {
            list-style: none;
            margin-bottom: 40px;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-item a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: #1a2980;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-item a:hover, .nav-item.active a {
            background-color: #1a2980;
            color: white;
        }

        .content {
            flex: 1;
            padding: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            color: #1a2980;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e1e8ff;
        }

        .filters {
            background-color: #f5f9ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .filters-title {
            font-weight: 600;
            color: #1a2980;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            color: #1a2980;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .filter-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-filter {
            padding: 8px 15px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .btn-filter-primary {
            background-color: #1a2980;
            color: white;
        }

        .btn-filter-primary:hover {
            background-color: #152068;
            transform: translateY(-2px);
        }

        .btn-filter-secondary {
            background-color: #26d0ce;
            color: white;
        }

        .btn-filter-secondary:hover {
            background-color: #1fb3b1;
            transform: translateY(-2px);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #1a2980;
            color: white;
        }

        .btn-primary:hover {
            background-color: #152068;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: #26d0ce;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #1fb3b1;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
            transform: translateY(-2px);
        }

        .search-sort {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-input, .sort-select {
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 0.9rem;
        }

        .flights-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .flights-table thead {
            background-color: #1a2980;
            color: white;
        }

        .flights-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .flights-table tbody tr {
            border-bottom: 1px solid #e1e8ff;
            transition: background-color 0.2s;
        }

        .flights-table tbody tr:hover {
            background-color: #f5f9ff;
        }

        .flights-table td {
            padding: 15px;
        }

        .flight-number {
            font-weight: 600;
            color: #1a2980;
        }

        .flight-duration {
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .flight-type {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }

        .type-direct {
            background-color: #d4edda;
            color: #155724;
        }

        .type-connecting {
            background-color: #cce5ff;
            color: #004085;
        }

        .free-seats {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .seats-available {
            background-color: #d4edda;
            color: #155724;
        }

        .seats-low {
            background-color: #fff3cd;
            color: #856404;
        }

        .seats-none {
            background-color: #f8d7da;
            color: #721c24;
        }

        .price-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 5px;
        }

        .price-low {
            background-color: #d4edda;
            color: #155724;
        }

        .price-medium {
            background-color: #fff3cd;
            color: #856404;
        }

        .price-high {
            background-color: #f8d7da;
            color: #721c24;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        .booking-form {
            max-width: 500px;
            margin: 0 auto;
        }

        .booking-details {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .booking-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .booking-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .booking-label {
            font-weight: 600;
            color: #1a2980;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .booking-value {
            font-size: 1.1rem;
        }

        .footer {
            text-align: center;
            padding: 20px;
            background-color: #f5f9ff;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #e1e8ff;
        }

        .actions-cell {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .action-btn-small {
            padding: 4px 8px;
            font-size: 0.75rem;
        }

        .form-hint {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
        }

        .input-error {
            border-color: #dc3545 !important;
            background-color: #fff8f9;
        }

        .error-message {
            color: #dc3545;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .boarding-list {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .boarding-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #e1e8ff;
            padding-bottom: 20px;
        }

        .boarding-header h2 {
            color: #1a2980;
            margin-bottom: 10px;
        }

        .boarding-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }

        .detail-item {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .detail-label {
            font-weight: 600;
            color: #1a2980;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .passenger-list {
            margin-bottom: 30px;
        }

        .passenger-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background-color: white;
            border: 1px solid #e1e8ff;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .passenger-item:hover {
            background-color: #f5f9ff;
            transform: translateX(5px);
        }

        /* Стили для печати */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .printable-boarding,
            .printable-boarding * {
                visibility: visible;
            }
            
            .printable-boarding {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background-color: white;
                font-family: 'Arial', sans-serif;
            }
            
            .no-print {
                display: none !important;
            }
            
            .boarding-print-header {
                text-align: center;
                margin-bottom: 30px;
                border-bottom: 3px double #000;
                padding-bottom: 15px;
            }
            
            .boarding-print-title {
                font-size: 24px;
                font-weight: bold;
                color: #000;
                margin-bottom: 5px;
            }
            
            .boarding-print-subtitle {
                font-size: 16px;
                color: #333;
                margin-bottom: 20px;
            }
            
            .boarding-print-details {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                margin-bottom: 30px;
                border: 1px solid #000;
                padding: 15px;
            }
            
            .boarding-print-detail {
                flex: 1;
                min-width: 200px;
                margin-bottom: 10px;
            }
            
            .boarding-print-label {
                font-weight: bold;
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .boarding-print-value {
                font-size: 16px;
                border-bottom: 1px dotted #000;
                padding-bottom: 3px;
            }
            
            .boarding-print-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }
            
            .boarding-print-table th {
                background-color: #f0f0f0;
                border: 1px solid #000;
                padding: 10px;
                text-align: left;
                font-weight: bold;
            }
            
            .boarding-print-table td {
                border: 1px solid #000;
                padding: 8px 10px;
            }
            
            .boarding-print-footer {
                margin-top: 50px;
                border-top: 2px solid #000;
                padding-top: 20px;
                text-align: center;
            }
            
            .boarding-print-signature {
                display: inline-block;
                width: 300px;
                margin-top: 40px;
                border-top: 1px solid #000;
                padding-top: 10px;
                text-align: center;
            }
        }

        @media (max-width: 768px) {
            .actions-cell {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Окно входа -->
    <div class="login-container" id="login-container">
        <div class="login-logo">
            <i class="fas fa-plane"></i>
        </div>
        <h1 class="login-title">SkyFlight Tickets</h1>
        <form id="login-form" class="login-form">
            <div class="form-group">
                <label for="username">Имя пользователя</label>
                <input type="text" class="form-control" id="username" placeholder="Введите имя пользователя" required>
            </div>
            <div class="form-group">
                <label for="password">Пароль</label>
                <input type="password" class="form-control" id="password" placeholder="Введите пароль" required>
            </div>
            <button type="submit" class="btn-login">Войти в систему</button>
        </form>

        <div class="login-hint">
            <p><strong>Тестовые учетные записи:</strong></p>
            <p> <strong>Оператор (может добавлять рейсы):</strong> Прохор / asdfgbnm4</p>
            <p> <strong>Пользователь (только просмотр):</strong> любой другой логин/пароль</p>
        </div>
    </div>

    <!-- Основная система -->
    <div class="container system-container" id="system-container">
        <header>
            <div class="logo">
                <i class="fas fa-plane"></i>
                <div class="logo-text">
                    <h1>SkyFlight Tickets</h1>
                    <p>Система управления расписанием рейсов</p>
                </div>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <p>Пользователь: <span id="current-user"></span></p>
                    <p>Дата: <span id="current-date"></span></p>
                </div>
                <button class="logout-btn" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Выйти
                </button>
            </div>
        </header>

        <main>
            <aside class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item active"><a href="#"><i class="fas fa-home"></i> Главная</a></li>
                    <li class="nav-item"><a href="#" id="menu-schedule"><i class="fas fa-calendar-alt"></i> Расписание</a></li>
                    <li class="nav-item operator-only"><a href="#" id="menu-add"><i class="fas fa-plus-circle"></i> Добавить рейс</a></li>
                    <li class="nav-item"><a href="#" id="menu-boarding"><i class="fas fa-clipboard-list"></i> Посадочная ведомость</a></li>
                </ul>

                <div class="system-status">
                    <div class="status-title">
                        <i class="fas fa-chart-line"></i>
                        Статистика
                    </div>
                    <div class="status-item">
                        <span>Всего рейсов:</span>
                        <span id="total-flights">6</span>
                    </div>
                    <div class="status-item">
                        <span>Свободных мест:</span>
                        <span id="total-seats">96</span>
                    </div>
                    <div class="status-item">
                        <span>Рейсов сегодня:</span>
                        <span id="today-flights">3</span>
                    </div>
                </div>
            </aside>

            <section class="content">
                <h2 class="section-title"><i class="fas fa-plane-departure"></i> Расписание рейсов</h2>

                <!-- Фильтры поиска -->
                <div class="filters">
                    <div class="filters-title">
                        <i class="fas fa-filter"></i> Фильтры поиска
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Цена билета</label>
                            <select class="filter-control" id="filter-price">
                                <option value="">Любая цена</option>
                                <option value="low">До 10,000 руб. (эконом)</option>
                                <option value="medium">10,000 - 20,000 руб. (стандарт)</option>
                                <option value="high">От 20,000 руб. (премиум)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Время в пути</label>
                            <select class="filter-control" id="filter-duration">
                                <option value="">Любое время</option>
                                <option value="short">До 3 часов (ближние)</option>
                                <option value="medium">3-6 часов (средние)</option>
                                <option value="long">Более 6 часов (дальние)</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Тип рейса</label>
                            <select class="filter-control" id="filter-type">
                                <option value="">Все типы</option>
                                <option value="direct">Прямой рейс</option>
                                <option value="connecting">С пересадками</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Количество свободных мест</label>
                            <select class="filter-control" id="filter-seats">
                                <option value="">Любое количество</option>
                                <option value="available">Есть свободные места</option>
                                <option value="few">Мало мест (менее 10)</option>
                                <option value="soldout">Рейс продан</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Время вылета</label>
                            <select class="filter-control" id="filter-time">
                                <option value="">Любое время</option>
                                <option value="morning">Утро (06:00 - 12:00)</option>
                                <option value="afternoon">День (12:00 - 18:00)</option>
                                <option value="evening">Вечер (18:00 - 24:00)</option>
                                <option value="night">Ночь (00:00 - 06:00)</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button class="btn-filter btn-filter-primary" id="apply-filters">
                            <i class="fas fa-check"></i> Применить фильтры
                        </button>
                        <button class="btn-filter btn-filter-secondary" id="reset-filters">
                            <i class="fas fa-times"></i> Сбросить фильтры
                        </button>
                    </div>
                </div>

                <!-- Управление -->
                <div class="controls">
                    <div class="buttons">
                        <button class="btn btn-primary operator-only" id="add-flight-btn">
                            <i class="fas fa-plus"></i> Добавить рейс
                        </button>
                        <button class="btn btn-secondary" id="generate-boarding-btn">
                            <i class="fas fa-file-alt"></i> Посадочная ведомость
                        </button>
                    </div>

                    <div class="search-sort">
                        <div class="search-box">
                            <input type="text" class="search-input" id="search-input" placeholder="Поиск по номеру рейса или маршруту...">
                            <button class="btn btn-primary" id="search-btn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>

                        <div class="sort-box">
                            <select class="sort-select" id="sort-select">
                                <option value="">Сортировка...</option>
                                <option value="price-asc">Цена: от низкой к высокой</option>
                                <option value="price-desc">Цена: от высокой к низкой</option>
                                <option value="duration-asc">Время в пути: кратчайшие</option>
                                <option value="duration-desc">Время в пути: самые долгие</option>
                                <option value="seats-asc">Места: от меньшего к большему</option>
                                <option value="seats-desc">Места: от большего к меньшему</option>
                            </select>
                            <button class="btn btn-primary" id="sort-btn">
                                <i class="fas fa-sort-amount-down"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Таблица рейсов -->
                <table class="flights-table">
                    <thead>
                        <tr>
                            <th>Номер рейса</th>
                            <th>Маршрут</th>
                            <th>Тип</th>
                            <th>Время отправления</th>
                            <th>Время в пути</th>
                            <th>Дни вылета</th>
                            <th>Цена</th>
                            <th>Свободные места</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="flights-tbody">
                        <!-- Данные будут загружены через JavaScript -->
                    </tbody>
                </table>

                <!-- Посадочная ведомость -->
                <div class="boarding-list" id="boarding-list" style="display: none;">
                    <div class="boarding-header">
                        <h2><i class="fas fa-clipboard-check"></i> Посадочная ведомость</h2>
                        <p>Рейс SF-1456: Москва (Шереметьево) → Сочи (Адлер)</p>
                        <p style="color: #666; font-size: 0.9rem; margin-top: 10px;">Дата формирования: <span id="boarding-generation-date"></span></p>
                    </div>

                    <div class="boarding-details">
                        <div class="detail-item">
                            <div class="detail-label">Номер рейса</div>
                            <div>SF-1456</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Маршрут</div>
                            <div>Москва (Шереметьево) → Сочи (Адлер)</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Дата и время вылета</div>
                            <div id="boarding-date-time"></div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Время в пути</div>
                            <div>2ч 30м</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Количество пассажиров</div>
                            <div>124</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Тип воздушного судна</div>
                            <div>Boeing 737-800</div>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 15px; color: #1a2980; border-bottom: 1px solid #e1e8ff; padding-bottom: 10px;">
                        <i class="fas fa-users"></i> Список пассажиров
                    </h3>
                    
                    <div class="passenger-list" id="printable-passenger-list">
                        <!-- Пассажиры будут загружены здесь -->
                    </div>

                    <div style="text-align: center; margin-top: 25px;">
                        <button class="btn btn-primary no-print" id="print-boarding-btn">
                            <i class="fas fa-print"></i> Распечатать ведомость
                        </button>
                        <button class="btn btn-secondary no-print" id="back-to-flights" style="margin-left: 15px;">
                            <i class="fas fa-arrow-left"></i> Вернуться к рейсам
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>© <span id="current-year"></span> SkyFlight Tickets. Все права защищены.</p>
            <p>Версия системы: 2.0 | Последнее обновление: <span id="current-date-footer"></span></p>
        </footer>
    </div>

    <!-- Модальное окно для добавления рейса -->
    <div class="modal" id="flight-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Добавление нового рейса</h2>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="flight-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="flight-number">Номер рейса *</label>
                            <input type="text" class="form-control" id="flight-number" required>
                            <span class="form-hint">Формат: XX-1234 (2-3 буквы, тире, 3-4 цифры). Пример: SF-1456</span>
                            <span class="error-message" id="flight-number-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="route">Маршрут *</label>
                            <input type="text" class="form-control" id="route" placeholder="Москва → Сочи" required>
                            <span class="form-hint">Пример: Москва (Шереметьево) → Сочи (Адлер)</span>
                            <span class="error-message" id="route-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="flight-type">Тип рейса *</label>
                            <select class="form-control" id="flight-type" required>
                                <option value="direct">Прямой рейс</option>
                                <option value="connecting">С пересадками</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="stops">Пункты промежуточной посадки</label>
                            <input type="text" class="form-control" id="stops" placeholder="Воронеж, Ростов-на-Дону">
                            <span class="form-hint">Только названия городов через запятую. Пример: Москва, Казань, Новосибирск</span>
                            <span class="error-message" id="stops-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="departure-time">Время отправления *</label>
                            <input type="time" class="form-control" id="departure-time" value="08:30" required>
                        </div>
                        <div class="form-group">
                            <label for="duration">Время в пути *</label>
                            <input type="text" class="form-control" id="duration" placeholder="2ч 30м" value="2ч 30м" required>
                            <span class="form-hint">Формат: Xч Yм. Пример: 2ч 30м, 4ч</span>
                            <span class="error-message" id="duration-error"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="days">Дни вылета *</label>
                            <select class="form-control" id="days" multiple required>
                                <option value="Пн">Понедельник</option>
                                <option value="Вт">Вторник</option>
                                <option value="Ср">Среда</option>
                                <option value="Чт">Четверг</option>
                                <option value="Пт">Пятница</option>
                                <option value="Сб">Суббота</option>
                                <option value="Вс">Воскресенье</option>
                            </select>
                            <span class="form-hint">Удерживайте Ctrl для выбора нескольких дней</span>
                            <span class="error-message" id="days-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="price-category">Категория цены *</label>
                            <select class="form-control" id="price-category" required>
                                <option value="low">Эконом (до 10,000 руб.)</option>
                                <option value="medium" selected>Стандарт (10,000-20,000 руб.)</option>
                                <option value="high">Премиум (от 20,000 руб.)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="price">Запрашиваемая цена (руб) *</label>
                            <input type="number" class="form-control" id="price" min="0" step="100" value="8500" required>
                            <span class="error-message" id="price-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="seats">Количество свободных мест *</label>
                            <input type="number" class="form-control" id="seats" min="0" max="300" value="12" required>
                            <span class="error-message" id="seats-error"></span>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 30px;">
                        <button type="submit" class="btn btn-primary" style="padding: 12px 30px;">
                            <i class="fas fa-save"></i> Сохранить рейс
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancel-modal" style="padding: 12px 30px; margin-left: 15px;">
                            <i class="fas fa-times"></i> Отмена
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно бронирования -->
    <div class="modal" id="booking-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="booking-title">Бронирование билета</h2>
                <button class="close-modal" onclick="closeBookingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="booking-details">
                    <div id="booking-info-content">
                        <!-- Информация о рейсе будет загружена сюда -->
                    </div>
                    <form id="booking-form" class="booking-form">
                        <div class="form-group">
                            <label for="passenger-name">ФИО пассажира *</label>
                            <input type="text" class="form-control" id="passenger-name" placeholder="Иванов Иван Иванович" required>
                            <span class="form-hint">Только буквы, пробелы и дефисы. Пример: Петров-Водкин Алексей</span>
                            <span class="error-message" id="passenger-name-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="passenger-phone">Номер телефона</label>
                            <input type="tel" class="form-control" id="passenger-phone" placeholder="+7 (999) 123-45-67">
                            <span class="form-hint">Формат: +7 (999) 123-45-67 или 89991234567</span>
                            <span class="error-message" id="passenger-phone-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="passenger-email">Email</label>
                            <input type="email" class="form-control" id="passenger-email" placeholder="ivanov@example.com">
                            <span class="error-message" id="passenger-email-error"></span>
                        </div>
                        <div class="form-group">
                            <label for="seat-number">Предпочитаемое место</label>
                            <input type="text" class="form-control" id="seat-number" placeholder="12A (оставьте пустым для любого)">
                            <span class="form-hint">Формат: число + буква (например: 12A, 24C)</span>
                            <span class="error-message" id="seat-number-error"></span>
                        </div>
                        <input type="hidden" id="booking-flight-id">
                        <div style="text-align: center; margin-top: 30px;">
                            <button type="submit" class="btn btn-success" style="padding: 12px 30px;">
                                <i class="fas fa-ticket-alt"></i> Подтвердить бронирование
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="closeBookingModal()" style="padding: 12px 30px; margin-left: 15px;">
                                <i class="fas fa-times"></i> Отмена
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно деталей рейса -->
    <div class="modal" id="details-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="details-title">Детали рейса</h2>
                <button class="close-modal" onclick="closeDetailsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="flight-details-content">
                    <!-- Детали будут загружены сюда -->
                </div>
            </div>
        </div>
    </div>

    <!-- Скрытый контейнер для печати -->
    <div id="print-container" style="display: none;"></div>

    <script>
        // Данные пользователей
        const users = {
            'Прохор': { password: 'asdfgbnm4', isOperator: true, name: 'Прохор Иванов' }
        };

        // Текущий пользователь
        let currentUser = null;

        // Массив для хранения бронирований
        let bookings = [];

        // Инициализация данных рейсов с расширенными характеристиками
        let flights = [
            {
                id: 1,
                number: "SF-1456",
                route: "Москва (Шереметьево) → Сочи (Адлер)",
                type: "direct",
                stops: "Воронеж",
                departure: "08:30",
                departureTimeCategory: "morning",
                duration: "2ч 30м",
                durationCategory: "short",
                days: ["Пн", "Ср", "Пт", "Вс"],
                price: 8500,
                priceCategory: "low",
                seats: 12,
                seatsCategory: "available"
            },
            {
                id: 2,
                number: "SF-1789",
                route: "Санкт-Петербург (Пулково) → Новосибирск (Толмачево)",
                type: "connecting",
                stops: "Екатеринбург, Омск",
                departure: "14:20",
                departureTimeCategory: "afternoon",
                duration: "4ч 15м",
                durationCategory: "medium",
                days: ["Вт", "Чт", "Сб"],
                price: 12500,
                priceCategory: "medium",
                seats: 24,
                seatsCategory: "available"
            },
            {
                id: 3,
                number: "SF-1123",
                route: "Казань → Краснодар",
                type: "direct",
                stops: "Ростов-на-Дону",
                departure: "11:45",
                departureTimeCategory: "morning",
                duration: "2ч 55м",
                durationCategory: "short",
                days: ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"],
                price: 6800,
                priceCategory: "low",
                seats: 5,
                seatsCategory: "few"
            },
            {
                id: 4,
                number: "SF-1567",
                route: "Москва (Домодедово) → Владивосток",
                type: "connecting",
                stops: "Новосибирск, Иркутск, Хабаровск",
                departure: "22:10",
                departureTimeCategory: "evening",
                duration: "8ч 45м",
                durationCategory: "long",
                days: ["Пн", "Чт", "Сб"],
                price: 24500,
                priceCategory: "high",
                seats: 38,
                seatsCategory: "available"
            },
            {
                id: 5,
                number: "SF-1345",
                route: "Сочи (Адлер) → Калининград",
                type: "connecting",
                stops: "Москва (Шереметьево)",
                departure: "09:15",
                departureTimeCategory: "morning",
                duration: "3ч 20м",
                durationCategory: "medium",
                days: ["Вт", "Пт", "Вс"],
                price: 11500,
                priceCategory: "medium",
                seats: 0,
                seatsCategory: "soldout"
            },
            {
                id: 6,
                number: "SF-1890",
                route: "Екатеринбург (Кольцово) → Минск",
                type: "connecting",
                stops: "Москва (Домодедово)",
                departure: "16:40",
                departureTimeCategory: "afternoon",
                duration: "3ч 50м",
                durationCategory: "medium",
                days: ["Ср", "Чт", "Сб"],
                price: 9200,
                priceCategory: "low",
                seats: 17,
                seatsCategory: "available"
            }
        ];

        // Данные пассажиров для посадочной ведомости
        const passengers = [
            { id: 1, name: "Иванов Иван Иванович", seat: "12A", ticketNumber: "TK-145678", boardingGroup: "1", baggage: "1 место, 23кг" },
            { id: 2, name: "Петрова Анна Сергеевна", seat: "12B", ticketNumber: "TK-145679", boardingGroup: "1", baggage: "1 место, 20кг" },
            { id: 3, name: "Сидоров Петр Васильевич", seat: "14C", ticketNumber: "TK-145680", boardingGroup: "2", baggage: "2 места, 32кг" },
            { id: 4, name: "Козлова Мария Дмитриевна", seat: "15A", ticketNumber: "TK-145681", boardingGroup: "2", baggage: "1 место, 18кг" },
            { id: 5, name: "Николаев Алексей Викторович", seat: "16B", ticketNumber: "TK-145682", boardingGroup: "3", baggage: "1 место, 23кг" },
            { id: 6, name: "Федорова Елена Петровна", seat: "18C", ticketNumber: "TK-145683", boardingGroup: "3", baggage: "1 место, 15кг" },
            { id: 7, name: "Морозов Дмитрий Сергеевич", seat: "20A", ticketNumber: "TK-145684", boardingGroup: "4", baggage: "2 места, 30кг" },
            { id: 8, name: "Волкова Ольга Ивановна", seat: "22B", ticketNumber: "TK-145685", boardingGroup: "4", baggage: "1 место, 23кг" }
        ];

        // Функции валидации
        function validateName(name) {
            const regex = /^[A-Za-zА-Яа-яЁё\s-]+$/;
            return regex.test(name) && name.length >= 2;
        }

        function validateFlightNumber(number) {
            const regex = /^[A-Za-zА-Яа-яЁё]{2,3}-\d{3,4}$/;
            return regex.test(number);
        }

        function validateRoute(route) {
            const regex = /^[A-Za-zА-Яа-яЁё0-9\s(),.-→]+$/;
            return regex.test(route) && route.length >= 5;
        }

        // Валидация для промежуточных пересадок - только буквы, запятые, пробелы и дефисы
        function validateStops(stops) {
            if (!stops) return true; // поле не обязательно
            
            // Проверяем, что строка не состоит только из пробелов
            if (stops.trim() === '') return true;
            
            // Разрешаем только буквы (включая кириллицу и латиницу), запятые, пробелы и дефисы
            const regex = /^[A-Za-zА-Яа-яЁё\s,-]+$/;
            
            // Также проверяем, что нет двух запятых подряд и что после запятой есть текст
            const parts = stops.split(',').map(part => part.trim()).filter(part => part !== '');
            
            return regex.test(stops) && parts.length > 0;
        }

        function formatPhone(phone) {
            const cleaned = phone.replace(/\D/g, '');
            
            if (cleaned.length < 10 || cleaned.length > 11) {
                return null;
            }
            
            let formatted;
            if (cleaned.length === 10) {
                formatted = `+7 (${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6,8)}-${cleaned.slice(8)}`;
            } else {
                formatted = `+${cleaned[0]} (${cleaned.slice(1,4)}) ${cleaned.slice(4,7)}-${cleaned.slice(7,9)}-${cleaned.slice(9)}`;
            }
            
            return formatted;
        }

        function validateEmail(email) {
            if (!email) return true;
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }

        function validateSeatNumber(seat) {
            if (!seat) return true;
            const regex = /^\d{1,3}[A-Za-zА-Яа-яЁё]$/;
            return regex.test(seat);
        }

        function validateDuration(duration) {
            const regex = /^\d+ч\s*\d*м?$/;
            return regex.test(duration);
        }

        // Функция для форматирования даты
        function formatDate(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }

        // Функция для форматирования даты и времени
        function formatDateTime(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${day}.${month}.${year} ${hours}:${minutes}`;
        }

        // Установка текущей даты
        function updateDates() {
            const now = new Date();
            document.getElementById('current-date').textContent = formatDate(now);
            document.getElementById('current-date-footer').textContent = formatDate(now);
            document.getElementById('current-year').textContent = now.getFullYear();

            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(8, 30, 0);
            document.getElementById('boarding-date-time').textContent = `${formatDate(tomorrow)}, 08:30`;
            
            // Устанавливаем дату формирования ведомости
            document.getElementById('boarding-generation-date').textContent = formatDateTime(now);
        }

        // Функция входа в систему
        function login(username, password) {
            if (users[username] && users[username].password === password) {
                currentUser = {
                    username: username,
                    isOperator: true,
                    name: users[username].name
                };
            } else {
                currentUser = {
                    username: username,
                    isOperator: false,
                    name: username
                };
            }

            document.getElementById('login-container').style.display = 'none';
            document.getElementById('system-container').style.display = 'block';
            document.getElementById('current-user').textContent = currentUser.name;

            updateUIForUserRole();
            updateDates();
            renderFlights();

            return true;
        }

        // Функция выхода из системы
        function logout() {
            currentUser = null;
            document.getElementById('login-container').style.display = 'block';
            document.getElementById('system-container').style.display = 'none';
            document.getElementById('login-form').reset();
        }

        // Обновление интерфейса в зависимости от роли
        function updateUIForUserRole() {
            const isOperator = currentUser.isOperator;
            document.querySelectorAll('.operator-only').forEach(element => {
                element.style.display = isOperator ? 'flex' : 'none';
            });
        }

        // Определение категории по количеству мест
        function getSeatsCategory(seats) {
            if (seats === 0) return "soldout";
            if (seats < 10) return "few";
            return "available";
        }

        // Определение категории по времени вылета
        function getTimeCategory(time) {
            const hour = parseInt(time.split(':')[0]);
            if (hour >= 6 && hour < 12) return "morning";
            if (hour >= 12 && hour < 18) return "afternoon";
            if (hour >= 18 && hour < 24) return "evening";
            return "night";
        }

        // Определение категории по цене
        function getPriceCategory(price) {
            if (price < 10000) return "low";
            if (price <= 20000) return "medium";
            return "high";
        }

        // Определение категории по времени в пути
        function getDurationCategory(duration) {
            const hours = parseInt(duration) || 0;
            if (hours < 3) return "short";
            if (hours <= 6) return "medium";
            return "long";
        }

        // Заполнение таблицы рейсами
        function renderFlights(flightsToRender = flights) {
            const tbody = document.getElementById('flights-tbody');
            tbody.innerHTML = '';

            let totalSeats = 0;
            let totalFlights = flightsToRender.length;

            flightsToRender.forEach(flight => {
                totalSeats += flight.seats;

                let seatsClass = 'seats-available';
                if (flight.seats === 0) seatsClass = 'seats-none';
                else if (flight.seats < 10) seatsClass = 'seats-low';

                let priceClass = 'price-low';
                if (flight.priceCategory === 'medium') priceClass = 'price-medium';
                else if (flight.priceCategory === 'high') priceClass = 'price-high';

                const typeText = flight.type === 'direct' ? 'Прямой' : 'С пересадками';
                const typeClass = flight.type === 'direct' ? 'type-direct' : 'type-connecting';

                const canBook = currentUser.isOperator && flight.seats > 0;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="flight-number">${flight.number}</td>
                    <td>${flight.route}</td>
                    <td><span class="flight-type ${typeClass}">${typeText}</span></td>
                    <td>${flight.departure}</td>
                    <td><span class="flight-duration">${flight.duration}</span></td>
                    <td>${flight.days.join(', ')}</td>
                    <td>
                        ${flight.price.toLocaleString('ru-RU')} руб.
                        <span class="price-badge ${priceClass}">
                            ${flight.priceCategory === 'low' ? 'Эконом' :
                              flight.priceCategory === 'medium' ? 'Стандарт' : 'Премиум'}
                        </span>
                    </td>
                    <td><span class="free-seats ${seatsClass}">${flight.seats} мест</span></td>
                    <td class="actions-cell">
                        ${canBook ? `
                            <button class="action-btn btn-success" onclick="openBookingModal(${flight.id})">
                                <i class="fas fa-ticket-alt"></i> Забронировать
                            </button>
                        ` : ''}
                        <button class="action-btn btn-primary" onclick="viewDetails(${flight.id})">
                            <i class="fas fa-eye"></i> Подробнее
                        </button>
                        ${currentUser.isOperator ? `
                            <button class="action-btn btn-danger action-btn-small" onclick="deleteFlight(${flight.id})">
                                <i class="fas fa-trash"></i> Удалить
                            </button>
                        ` : ''}
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('total-flights').textContent = totalFlights;
            document.getElementById('total-seats').textContent = totalSeats;
            updateUIForUserRole();
        }

        // Поиск рейса
        function searchFlights() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const filteredFlights = flights.filter(flight =>
                flight.number.toLowerCase().includes(searchInput) ||
                flight.route.toLowerCase().includes(searchInput)
            );

            if (filteredFlights.length === 0 && searchInput !== '') {
                alert('Рейсы по указанному запросу не найдены');
                return;
            }

            renderFlights(searchInput === '' ? flights : filteredFlights);
        }

        // Применение фильтров
        function applyFilters() {
            const priceFilter = document.getElementById('filter-price').value;
            const durationFilter = document.getElementById('filter-duration').value;
            const typeFilter = document.getElementById('filter-type').value;
            const seatsFilter = document.getElementById('filter-seats').value;
            const timeFilter = document.getElementById('filter-time').value;

            let filteredFlights = flights;

            if (priceFilter === 'low') {
                filteredFlights = filteredFlights.filter(f => f.priceCategory === 'low');
            } else if (priceFilter === 'medium') {
                filteredFlights = filteredFlights.filter(f => f.priceCategory === 'medium');
            } else if (priceFilter === 'high') {
                filteredFlights = filteredFlights.filter(f => f.priceCategory === 'high');
            }

            if (durationFilter === 'short') {
                filteredFlights = filteredFlights.filter(f => f.durationCategory === 'short');
            } else if (durationFilter === 'medium') {
                filteredFlights = filteredFlights.filter(f => f.durationCategory === 'medium');
            } else if (durationFilter === 'long') {
                filteredFlights = filteredFlights.filter(f => f.durationCategory === 'long');
            }

            if (typeFilter === 'direct') {
                filteredFlights = filteredFlights.filter(f => f.type === 'direct');
            } else if (typeFilter === 'connecting') {
                filteredFlights = filteredFlights.filter(f => f.type === 'connecting');
            }

            if (seatsFilter === 'available') {
                filteredFlights = filteredFlights.filter(f => f.seatsCategory === 'available');
            } else if (seatsFilter === 'few') {
                filteredFlights = filteredFlights.filter(f => f.seatsCategory === 'few');
            } else if (seatsFilter === 'soldout') {
                filteredFlights = filteredFlights.filter(f => f.seatsCategory === 'soldout');
            }

            if (timeFilter === 'morning') {
                filteredFlights = filteredFlights.filter(f => f.departureTimeCategory === 'morning');
            } else if (timeFilter === 'afternoon') {
                filteredFlights = filteredFlights.filter(f => f.departureTimeCategory === 'afternoon');
            } else if (timeFilter === 'evening') {
                filteredFlights = filteredFlights.filter(f => f.departureTimeCategory === 'evening');
            } else if (timeFilter === 'night') {
                filteredFlights = filteredFlights.filter(f => f.departureTimeCategory === 'night');
            }

            if (filteredFlights.length === 0) {
                alert('Нет рейсов, соответствующих выбранным фильтрам');
            }

            renderFlights(filteredFlights);
        }

        // Сброс фильтров
        function resetFilters() {
            document.getElementById('filter-price').value = '';
            document.getElementById('filter-duration').value = '';
            document.getElementById('filter-type').value = '';
            document.getElementById('filter-seats').value = '';
            document.getElementById('filter-time').value = '';
            renderFlights(flights);
        }

        // Сортировка рейсов
        function sortFlights() {
            const sortBy = document.getElementById('sort-select').value;
            let sortedFlights = [...flights];

            if (sortBy === 'price-asc') {
                sortedFlights.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price-desc') {
                sortedFlights.sort((a, b) => b.price - a.price);
            } else if (sortBy === 'duration-asc') {
                sortedFlights.sort((a, b) => {
                    const getMinutes = (duration) => {
                        const hours = parseInt(duration) || 0;
                        const minutes = parseInt(duration.split(' ')[1]) || 0;
                        return hours * 60 + minutes;
                    };
                    return getMinutes(a.duration) - getMinutes(b.duration);
                });
            } else if (sortBy === 'duration-desc') {
                sortedFlights.sort((a, b) => {
                    const getMinutes = (duration) => {
                        const hours = parseInt(duration) || 0;
                        const minutes = parseInt(duration.split(' ')[1]) || 0;
                        return hours * 60 + minutes;
                    };
                    return getMinutes(b.duration) - getMinutes(a.duration);
                });
            } else if (sortBy === 'seats-asc') {
                sortedFlights.sort((a, b) => a.seats - b.seats);
            } else if (sortBy === 'seats-desc') {
                sortedFlights.sort((a, b) => b.seats - a.seats);
            }

            renderFlights(sortedFlights);
        }

        // Заполнение списка пассажиров для печати
        function renderPassengerList() {
            const passengerList = document.getElementById('printable-passenger-list');
            passengerList.innerHTML = '';
            
            passengers.forEach(passenger => {
                const passengerItem = document.createElement('div');
                passengerItem.className = 'passenger-item';
                passengerItem.innerHTML = `
                    <div>
                        <strong>${passenger.name}</strong><br>
                        <small style="color: #666;">Билет: ${passenger.ticketNumber} | Группа посадки: ${passenger.boardingGroup}</small>
                    </div>
                    <div style="text-align: right;">
                        <div><strong>Место: ${passenger.seat}</strong></div>
                        <small style="color: #666;">Багаж: ${passenger.baggage}</small>
                    </div>
                `;
                passengerList.appendChild(passengerItem);
            });
        }

        // Функция печати посадочной ведомости
        function printBoardingPass() {
            // Создаем содержимое для печати
            const printContent = `
                <div class="printable-boarding">
                    <div class="boarding-print-header">
                        <div class="boarding-print-title">ПОСАДОЧНАЯ ВЕДОМОСТЬ</div>
                        <div class="boarding-print-subtitle">Авиакомпания "SkyFlight"</div>
                        <div>Рейс SF-1456: Москва (Шереметьево) → Сочи (Адлер)</div>
                        <div style="margin-top: 10px; font-size: 14px;">Дата формирования: ${formatDateTime(new Date())}</div>
                    </div>
                    
                    <div class="boarding-print-details">
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Номер рейса</div>
                            <div class="boarding-print-value">SF-1456</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Маршрут</div>
                            <div class="boarding-print-value">Москва (Шереметьево) → Сочи (Адлер)</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Дата и время вылета</div>
                            <div class="boarding-print-value">${document.getElementById('boarding-date-time').textContent}</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Время в пути</div>
                            <div class="boarding-print-value">2ч 30м</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Тип ВС</div>
                            <div class="boarding-print-value">Boeing 737-800</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Кол-во пассажиров</div>
                            <div class="boarding-print-value">${passengers.length}</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Командир ВС</div>
                            <div class="boarding-print-value">Петров А.В.</div>
                        </div>
                        <div class="boarding-print-detail">
                            <div class="boarding-print-label">Старший бортпроводник</div>
                            <div class="boarding-print-value">Иванова М.С.</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; font-weight: bold; font-size: 16px;">СПИСОК ПАССАЖИРОВ</div>
                    
                    <table class="boarding-print-table">
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>ФИО пассажира</th>
                                <th>Номер билета</th>
                                <th>Место</th>
                                <th>Группа посадки</th>
                                <th>Багаж</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${passengers.map((passenger, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${passenger.name}</td>
                                    <td>${passenger.ticketNumber}</td>
                                    <td>${passenger.seat}</td>
                                    <td>${passenger.boardingGroup}</td>
                                    <td>${passenger.baggage}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div class="boarding-print-footer">
                        <div style="text-align: left; margin-top: 30px;">
                            <div><strong>Примечания:</strong></div>
                            <div>1. Пассажиры обязаны пройти регистрацию не позднее чем за 40 минут до вылета.</div>
                            <div>2. Посадка начинается за 30 минут до вылета.</div>
                            <div>3. Допустимый вес ручной клади - 10 кг.</div>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 50px;">
                            <div class="boarding-print-signature">
                                Старший бортпроводник<br>
                                _________________ /Иванова М.С./
                            </div>
                            <div class="boarding-print-signature">
                                Агент по регистрации<br>
                                _________________ /${currentUser ? currentUser.name : 'Прохор Иванов'}/
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; font-size: 12px; color: #666;">
                            Ведомость сформирована автоматически в системе SkyFlight Tickets
                        </div>
                    </div>
                </div>
            `;
            
            // Вставляем содержимое в скрытый контейнер
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = printContent;
            
            // Сохраняем оригинальное содержимое body
            const originalContent = document.body.innerHTML;
            
            // Заменяем содержимое body на содержимое для печати
            document.body.innerHTML = printContent;
            
            // Запускаем печать
            window.print();
            
            // Восстанавливаем оригинальное содержимое
            document.body.innerHTML = originalContent;
            
            // Восстанавливаем обработчики событий
            initializeEventHandlers();
            
            // Показываем сообщение об успешной печати
            setTimeout(() => {
                alert('Посадочная ведомость отправлена на печать. Если печать не началась, проверьте настройки принтера.');
            }, 100);
        }

        // Открытие модального окна для добавления рейса
        function openAddModal() {
            if (!currentUser.isOperator) {
                alert('Только оператор может добавлять рейсы');
                return;
            }

            document.getElementById('modal-title').textContent = 'Добавление нового рейса';
            document.getElementById('flight-form').reset();
            document.getElementById('flight-modal').style.display = 'flex';
        }

        // Сброс ошибок валидации
        function resetValidationErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
            });
            document.querySelectorAll('.input-error').forEach(el => {
                el.classList.remove('input-error');
            });
        }

        // Отображение ошибки валидации
        function showError(inputId, message) {
            const input = document.getElementById(inputId);
            const errorEl = document.getElementById(`${inputId}-error`);
            
            if (input && errorEl) {
                input.classList.add('input-error');
                errorEl.textContent = message;
                errorEl.style.display = 'block';
            }
        }

        // Сохранение рейса с валидацией
        function saveFlight(event) {
            event.preventDefault();

            if (!currentUser.isOperator) {
                alert('Только оператор может добавлять рейсы');
                return;
            }

            resetValidationErrors();

            const flightNumber = document.getElementById('flight-number').value;
            const route = document.getElementById('route').value;
            const stops = document.getElementById('stops').value;
            const duration = document.getElementById('duration').value;
            const price = parseInt(document.getElementById('price').value);
            const seats = parseInt(document.getElementById('seats').value);
            const days = Array.from(document.getElementById('days').selectedOptions).map(opt => opt.value);

            let isValid = true;

            if (!validateFlightNumber(flightNumber)) {
                showError('flight-number', 'Номер рейса должен быть в формате: "XX-1234" (2-3 буквы, тире, 3-4 цифры)');
                isValid = false;
            }

            if (!validateRoute(route)) {
                showError('route', 'Маршрут содержит недопустимые символы. Используйте только буквы, цифры, скобки и тире.');
                isValid = false;
            }

            if (!validateStops(stops)) {
                showError('stops', 'Укажите города через запятую. Пример: Москва, Казань, Новосибирск');
                isValid = false;
            }

            if (!validateDuration(duration)) {
                showError('duration', 'Время в пути должно быть в формате: "2ч 30м" или "2ч"');
                isValid = false;
            }

            if (price < 1000 || price > 100000) {
                if (!confirm('Цена выходит за разумные пределы (1000-100000 руб). Продолжить?')) {
                    isValid = false;
                }
            }

            if (seats < 0 || seats > 500) {
                showError('seats', 'Количество мест должно быть от 0 до 500');
                isValid = false;
            }

            if (days.length === 0) {
                showError('days', 'Выберите хотя бы один день вылета');
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            const flightData = {
                id: flights.length + 1,
                number: flightNumber.toUpperCase(),
                route: route,
                type: document.getElementById('flight-type').value,
                stops: stops || '',
                departure: document.getElementById('departure-time').value,
                departureTimeCategory: getTimeCategory(document.getElementById('departure-time').value),
                duration: duration,
                durationCategory: getDurationCategory(duration),
                days: days,
                price: price,
                priceCategory: document.getElementById('price-category').value,
                seats: seats,
                seatsCategory: getSeatsCategory(seats)
            };

            flights.push(flightData);
            document.getElementById('flight-modal').style.display = 'none';
            renderFlights(flights);
            resetFilters();
            alert(`Рейс ${flightData.number} успешно добавлен!`);
        }

        // Удаление рейса
        function deleteFlight(flightId) {
            if (!currentUser.isOperator) {
                alert('Только оператор может удалять рейсы');
                return;
            }

            const flight = flights.find(f => f.id === flightId);
            if (!flight) return;

            if (confirm(`Вы уверены, что хотите удалить рейс ${flight.number}?`)) {
                flights = flights.filter(f => f.id !== flightId);
                renderFlights();
                alert(`Рейс ${flight.number} успешно удален!`);
            }
        }

        // Открытие модального окна бронирования
        function openBookingModal(flightId) {
            if (!currentUser.isOperator) {
                alert('Только оператор может бронировать билеты');
                return;
            }

            const flight = flights.find(f => f.id === flightId);
            if (!flight) return;

            if (flight.seats === 0) {
                alert('На этот рейс нет свободных мест!');
                return;
            }

            document.getElementById('booking-flight-id').value = flightId;
            document.getElementById('booking-title').textContent = `Бронирование: ${flight.number}`;

            const bookingInfoHTML = `
                <div class="booking-info">
                    <div class="booking-item">
                        <div class="booking-label">Номер рейса</div>
                        <div class="booking-value">${flight.number}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Маршрут</div>
                        <div class="booking-value">${flight.route}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Время вылета</div>
                        <div class="booking-value">${flight.departure}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Цена</div>
                        <div class="booking-value">${flight.price.toLocaleString('ru-RU')} руб.</div>
                    </div>
                </div>
            `;

            document.getElementById('booking-info-content').innerHTML = bookingInfoHTML;
            document.getElementById('booking-form').reset();
            resetValidationErrors();
            document.getElementById('booking-modal').style.display = 'flex';
        }

        // Закрытие модального окна бронирования
        function closeBookingModal() {
            document.getElementById('booking-modal').style.display = 'none';
        }

        // Обработка бронирования с валидацией
        function processBooking(event) {
            event.preventDefault();

            const flightId = parseInt(document.getElementById('booking-flight-id').value);
            const flight = flights.find(f => f.id === flightId);

            if (!flight || flight.seats === 0) {
                alert('К сожалению, на этот рейс больше нет свободных мест');
                closeBookingModal();
                return;
            }

            resetValidationErrors();

            const passengerName = document.getElementById('passenger-name').value;
            const passengerPhone = document.getElementById('passenger-phone').value;
            const passengerEmail = document.getElementById('passenger-email').value;
            const seatNumber = document.getElementById('seat-number').value;

            let isValid = true;

            if (!validateName(passengerName)) {
                showError('passenger-name', 'ФИО должно содержать только буквы, пробелы и дефисы. Минимум 2 символа.');
                isValid = false;
            }

            const formattedPhone = formatPhone(passengerPhone);
            if (passengerPhone && !formattedPhone) {
                showError('passenger-phone', 'Неверный формат телефона. Введите 10 или 11 цифр.');
                isValid = false;
            }

            if (!validateEmail(passengerEmail)) {
                showError('passenger-email', 'Неверный формат email');
                isValid = false;
            }

            if (!validateSeatNumber(seatNumber)) {
                showError('seat-number', 'Номер места должен быть в формате: "12A" (число + буква)');
                isValid = false;
            }

            if (!isValid) {
                return;
            }

            const booking = {
                id: bookings.length + 1,
                flightId: flightId,
                flightNumber: flight.number,
                passengerName: passengerName,
                passengerPhone: formattedPhone || passengerPhone,
                passengerEmail: passengerEmail,
                seatNumber: seatNumber || 'Автоматически',
                bookingDate: new Date().toLocaleString('ru-RU'),
                price: flight.price,
                bookingNumber: 'BK-' + Date.now().toString().slice(-8)
            };

            bookings.push(booking);

            flight.seats--;
            flight.seatsCategory = getSeatsCategory(flight.seats);

            renderFlights();
            closeBookingModal();

            alert(`
                ✅ Бронирование подтверждено!

                Номер бронирования: ${booking.bookingNumber}
                Рейс: ${booking.flightNumber}
                Пассажир: ${booking.passengerName}
                Место: ${booking.seatNumber}
                Цена: ${booking.price.toLocaleString('ru-RU')} руб.

                Бронирование оформлено: ${booking.bookingDate}
            `);
        }

        // Функция просмотра деталей рейса
        function viewDetails(flightId) {
            const flight = flights.find(f => f.id === flightId);
            if (!flight) return;

            const detailsHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 1.5rem; color: #1a2980; margin-bottom: 10px;">
                        <i class="fas fa-plane"></i> Рейс ${flight.number}
                    </div>
                    <div style="color: #666; font-size: 0.9rem;">${flight.route}</div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div class="booking-item">
                        <div class="booking-label">Тип рейса</div>
                        <div class="booking-value">${flight.type === 'direct' ? 'Прямой' : 'С пересадками'}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Время вылета</div>
                        <div class="booking-value">${flight.departure}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Время в пути</div>
                        <div class="booking-value">${flight.duration}</div>
                    </div>
                    <div class="booking-item">
                        <div class="booking-label">Цена</div>
                        <div class="booking-value">${flight.price.toLocaleString('ru-RU')} руб.</div>
                    </div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div class="booking-label">Промежуточные посадки</div>
                    <div>${flight.stops || 'Нет'}</div>
                </div>

                <div style="margin-bottom: 15px;">
                    <div class="booking-label">Дни вылета</div>
                    <div>${flight.days.join(', ')}</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div class="booking-label">Свободные места</div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                        <span class="free-seats ${flight.seats === 0 ? 'seats-none' : flight.seats < 10 ? 'seats-low' : 'seats-available'}">
                            ${flight.seats} мест
                        </span>
                        ${currentUser.isOperator && flight.seats > 0 ?
                            `<button class="btn btn-success" onclick="openBookingModal(${flight.id})" style="padding: 8px 15px;">
                                <i class="fas fa-ticket-alt"></i> Забронировать
                            </button>` :
                            ''
                        }
                    </div>
                </div>

                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #1a2980;">
                    <div class="booking-label">Категория цены</div>
                    <div style="margin-top: 5px;">
                        <span class="price-badge ${flight.priceCategory === 'low' ? 'price-low' : flight.priceCategory === 'medium' ? 'price-medium' : 'price-high'}">
                            ${flight.priceCategory === 'low' ? 'Эконом' :
                              flight.priceCategory === 'medium' ? 'Стандарт' : 'Премиум'}
                        </span>
                        <span style="margin-left: 10px; color: #666; font-size: 0.9rem;">
                            ${flight.priceCategory === 'low' ? 'Бюджетный вариант' :
                              flight.priceCategory === 'medium' ? 'Оптимальное соотношение цены и комфорта' :
                              'Максимальный комфорт и сервис'}
                        </span>
                    </div>
                </div>
            `;

            document.getElementById('flight-details-content').innerHTML = detailsHTML;
            document.getElementById('details-title').textContent = `Рейс ${flight.number}`;
            document.getElementById('details-modal').style.display = 'flex';
        }

        // Закрытие модального окна деталей
        function closeDetailsModal() {
            document.getElementById('details-modal').style.display = 'none';
        }

        // Показать посадочную ведомость
        function toggleBoardingList() {
            const boardingList = document.getElementById('boarding-list');
            const flightsTable = document.querySelector('.flights-table');
            const controls = document.querySelector('.controls');
            const filters = document.querySelector('.filters');

            if (boardingList.style.display === 'none') {
                // Обновляем дату формирования
                document.getElementById('boarding-generation-date').textContent = formatDateTime(new Date());
                
                // Заполняем список пассажиров
                renderPassengerList();
                
                // Показываем ведомость, скрываем остальное
                boardingList.style.display = 'block';
                flightsTable.style.display = 'none';
                controls.style.display = 'none';
                filters.style.display = 'none';
                document.querySelector('.section-title').innerHTML = '<i class="fas fa-clipboard-check"></i> Посадочная ведомость';
            } else {
                // Скрываем ведомость, показываем остальное
                boardingList.style.display = 'none';
                flightsTable.style.display = 'table';
                controls.style.display = 'flex';
                filters.style.display = 'block';
                document.querySelector('.section-title').innerHTML = '<i class="fas fa-plane-departure"></i> Расписание рейсов';
            }
        }

        // Функция для возврата к списку рейсов
        function backToFlights() {
            const boardingList = document.getElementById('boarding-list');
            const flightsTable = document.querySelector('.flights-table');
            const controls = document.querySelector('.controls');
            const filters = document.querySelector('.filters');
            
            boardingList.style.display = 'none';
            flightsTable.style.display = 'table';
            controls.style.display = 'flex';
            filters.style.display = 'block';
            document.querySelector('.section-title').innerHTML = '<i class="fas fa-plane-departure"></i> Расписание рейсов';
        }

        // Восстановление обработчиков событий после печати
        function initializeEventHandlers() {
            // Повторно инициализируем обработчики событий
            document.getElementById('login-form')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username && password) {
                    login(username, password);
                } else {
                    alert('Введите имя пользователя и пароль');
                }
            });

            document.getElementById('logout-btn')?.addEventListener('click', logout);
            document.getElementById('print-boarding-btn')?.addEventListener('click', printBoardingPass);
            document.getElementById('back-to-flights')?.addEventListener('click', backToFlights);
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            // Обработка формы входа
            document.getElementById('login-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                if (username && password) {
                    login(username, password);
                } else {
                    alert('Введите имя пользователя и пароль');
                }
            });

            // Обработка выхода
            document.getElementById('logout-btn').addEventListener('click', logout);

            // Назначение обработчиков
            document.getElementById('add-flight-btn').addEventListener('click', openAddModal);
            document.getElementById('search-btn').addEventListener('click', searchFlights);
            document.getElementById('sort-btn').addEventListener('click', sortFlights);
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            document.getElementById('generate-boarding-btn').addEventListener('click', toggleBoardingList);
            document.getElementById('print-boarding-btn').addEventListener('click', printBoardingPass);
            document.getElementById('back-to-flights').addEventListener('click', backToFlights);

            document.getElementById('menu-schedule').addEventListener('click', () => {
                backToFlights();
            });

            document.getElementById('menu-add').addEventListener('click', openAddModal);
            document.getElementById('menu-boarding').addEventListener('click', toggleBoardingList);

            document.getElementById('flight-form').addEventListener('submit', saveFlight);
            document.getElementById('close-modal').addEventListener('click', () => {
                document.getElementById('flight-modal').style.display = 'none';
            });
            document.getElementById('cancel-modal').addEventListener('click', () => {
                document.getElementById('flight-modal').style.display = 'none';
            });

            document.getElementById('booking-form').addEventListener('submit', processBooking);

            // Поиск при нажатии Enter
            document.getElementById('search-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchFlights();
            });

            // Валидация в реальном времени для всех текстовых полей
            const passengerNameInput = document.getElementById('passenger-name');
            const passengerPhoneInput = document.getElementById('passenger-phone');
            const seatNumberInput = document.getElementById('seat-number');
            const flightNumberInput = document.getElementById('flight-number');
            const routeInput = document.getElementById('route');
            const stopsInput = document.getElementById('stops');
            
            if (passengerNameInput) {
                passengerNameInput.addEventListener('input', function() {
                    this.value = this.value.replace(/[^A-Za-zА-Яа-яЁё\s-]/g, '');
                });
            }
            
            if (passengerPhoneInput) {
                passengerPhoneInput.addEventListener('input', function() {
                    this.value = this.value.replace(/[^\d+()-]/g, '');
                });
            }
            
            if (seatNumberInput) {
                seatNumberInput.addEventListener('input', function() {
                    this.value = this.value.toUpperCase().replace(/[^A-Za-zА-Яа-яЁё0-9]/g, '');
                });
            }
            
            if (flightNumberInput) {
                flightNumberInput.addEventListener('input', function() {
                    this.value = this.value.toUpperCase().replace(/[^A-Za-zА-Яа-яЁё0-9-]/g, '');
                });
            }
            
            if (routeInput) {
                routeInput.addEventListener('input', function() {
                    this.value = this.value.replace(/[^A-Za-zА-Яа-яЁё0-9\s(),.-→]/g, '');
                });
            }
            
            if (stopsInput) {
                stopsInput.addEventListener('input', function() {
                    // Удаляем цифры и специальные символы, оставляем только буквы, запятые, пробелы и дефисы
                    this.value = this.value.replace(/[^A-Za-zА-Яа-яЁё\s,-]/g, '');
                    
                    // Убираем возможные двойные запятые
                    this.value = this.value.replace(/,+/g, ',');
                    
                    // Убираем запятую в начале строки
                    if (this.value.startsWith(',')) {
                        this.value = this.value.substring(1);
                    }
                    
                    // Убираем лишние пробелы вокруг запятых
                    this.value = this.value.replace(/\s*,\s*/g, ', ');
                    
                    // Делаем первую букву каждого слова заглавной
                    const words = this.value.split(/,?\s+/);
                    for (let i = 0; i < words.length; i++) {
                        if (words[i]) {
                            words[i] = words[i].charAt(0).toUpperCase() + words[i].slice(1).toLowerCase();
                        }
                    }
                    this.value = words.join(' ');
                });
            }

            // Закрытие модальных окон при клике вне их
            window.addEventListener('click', (e) => {
                const modals = ['flight-modal', 'booking-modal', 'details-modal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>
